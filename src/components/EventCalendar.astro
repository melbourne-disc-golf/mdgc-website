---
import type { CalendarEvent } from '@utils/events';
import EventCalendarList from './EventCalendarList.astro';
import EventCalendarGrid from './EventCalendarGrid.astro';

interface Props {
  events: CalendarEvent[];
  maxDaysInPast?: number;
  maxDaysInFuture?: number;
  defaultView?: 'list' | 'grid';
}

const { events, maxDaysInPast, maxDaysInFuture, defaultView = 'list' } = Astro.props;
---

<div class="event-calendar-toggle" data-default-view={defaultView}>
  <fieldset class="view-toggle">
    <legend class="sr-only">Calendar view</legend>
    <div class="toggle-options">
      <label class="toggle-option">
        <input type="radio" name="calendar-view" value="list" checked={defaultView === 'list'} />
        <span>List</span>
      </label>
      <label class="toggle-option">
        <input type="radio" name="calendar-view" value="grid" checked={defaultView === 'grid'} />
        <span>Grid</span>
      </label>
    </div>
  </fieldset>

  <div class="calendar-view slide-left" data-view="list">
    <EventCalendarList events={events} maxDaysInPast={maxDaysInPast} maxDaysInFuture={maxDaysInFuture} />
  </div>

  <div class="calendar-view slide-right" data-view="grid">
    <EventCalendarGrid events={events} maxDaysInPast={maxDaysInPast} maxDaysInFuture={maxDaysInFuture} />
  </div>
</div>

<style>
  .sr-only {
    position: absolute;
    width: 1px; 
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
  }

  .view-toggle {
    border: none;
    padding: 0;
    margin: 0 0 1rem 0;
  }

  .toggle-options {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .toggle-option {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--color-text, #111827);
  }

  .toggle-option input {
    width: 1rem;
    height: 1rem;
    accent-color: var(--color-primary, #3b82f6);
    cursor: pointer;
  }

  .calendar-views {
    position: relative;
    overflow: hidden;
  }

  .calendar-view {
    display: none;
  }

  .calendar-view.active {
    display: block;
  }

  .calendar-view.active.animate {
    animation: 0.25s ease-out;
  }

  .calendar-view.slide-right.animate {
    animation-name: slide-right;
  }

  .calendar-view.slide-left.animate {
    animation-name: slide-left;
  }

  @keyframes slide-right {
    from {
      opacity: 0;
      transform: translateX(-5rem);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  @keyframes slide-left {
    from {
      opacity: 0;
      transform: translateX(5rem);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
</style>

<script>
  function initCalendarToggles() {
    document.querySelectorAll('.event-calendar-toggle').forEach((container) => {
      const defaultView = container.getAttribute('data-default-view') || 'list';
      const radios = container.querySelectorAll('input[name="calendar-view"]');
      const views = container.querySelectorAll('.calendar-view');
      let currentView = defaultView;

      function showView(viewName: string, animate = false) {
        views.forEach((view) => {
          view.classList.remove('active', 'animate');
          if (view.getAttribute('data-view') === viewName) {
            if (animate && viewName !== currentView) {
              view.classList.add('animate');
            }
            view.classList.add('active');
          }
        });
        currentView = viewName;
      }

      function syncViewToRadio() {
        const checked = container.querySelector('input[name="calendar-view"]:checked') as HTMLInputElement | null;
        showView(checked?.value || defaultView, false);
      }

      syncViewToRadio();

      radios.forEach((radio) => {
        radio.addEventListener('change', (e) => {
          const target = e.target as HTMLInputElement;
          if (target.checked) {
            showView(target.value, true);
          }
        });
      });
    });
  }

  initCalendarToggles();
  window.addEventListener('pageshow', initCalendarToggles);
</script>
