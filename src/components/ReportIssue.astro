---
// Component for reporting issues via GitHub
---

<button
	id="report-issue-btn"
	class="inline-block text-gray-400 hover:text-white transition-colors"
	aria-label="Report an issue"
	title="Report an issue"
>
	<span class="flex items-center gap-1">
		<svg class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24">
			<circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>
			<text x="12" y="17" text-anchor="middle" font-size="14" font-weight="bold" fill="currentColor">!</text>
		</svg>
	</span>
</button>

<!-- Modal -->
<div id="issue-modal" class="fixed inset-0 backdrop-blur-sm bg-black/5 hidden z-2000">
	<div id="issue-modal-content" class="bg-white rounded-lg shadow-2xl max-w-md w-full absolute bottom-20 right-4 transform transition-all duration-200 ease-out opacity-0 scale-95">
		<div class="p-6">
			<div class="flex justify-between items-start mb-4">
				<h2 class="text-2xl font-bold text-gray-900">Report an issue</h2>
				<button id="close-modal" class="text-gray-400 hover:text-gray-600 transition-colors">
					<svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
					</svg>
				</button>
			</div>

			<p class="text-sm text-gray-700 mb-6">
				We welcome feedback, so please get in touch if you've spotted a problem, or have a suggestion.
			</p>

			<div class="modal-buttons">
				<button
					id="submit-btn"
					class="primary"
					title="Preferred option, but requires a GitHub account"
				>
					Report via GitHub
				</button>
				<button
					id="email-btn"
					class="secondary"
					title="If you don't have a GitHub account"
				>
					Email site admins
				</button>
				<button id="cancel-btn">
					Cancel
				</button>
			</div>
		</div>
	</div>
</div>

<style>
	.modal-buttons {
		display: flex;
		flex-direction: column;
		gap: 0.75rem;
	}

	.modal-buttons button {
		padding: 0.5rem 1rem;
		border-radius: 0.375rem;
		transition: background-color 0.15s, transform 0.2s ease-in-out;
		border: 1px solid #d1d5db;
		color: #374151;
	}

	.modal-buttons button:hover {
		transform: scale(1.02);
		background-color: #f9fafb;
	}

	.modal-buttons button.primary {
		background-color: #2563eb;
		border-color: #2563eb;
		color: white;
	}

	.modal-buttons button.primary:hover {
		background-color: #1d4ed8;
	}

	.modal-buttons button.secondary {
		background-color: #e5e7eb;
	}

	.modal-buttons button.secondary:hover {
		background-color: #d1d5db;
	}
</style>

<script>
	const modal = document.getElementById('issue-modal');
	const modalContent = document.getElementById('issue-modal-content');
	const reportBtn = document.getElementById('report-issue-btn');
	const closeBtn = document.getElementById('close-modal');
	const cancelBtn = document.getElementById('cancel-btn');
	const submitBtn = document.getElementById('submit-btn');
	const emailBtn = document.getElementById('email-btn');

	// Gather browser information
	function getBrowserInfo(): string {
		const info = [
			`- Browser: \`${navigator.userAgent}\``,
			`- Viewport: \`${window.innerWidth}x${window.innerHeight}\``,
			`- Screen: \`${window.screen.width}x${window.screen.height}\``,
		];
		return info.join('\n');
	}

	// Open GitHub issue form
	function openGitHubIssue() {
		const pageUrl = window.location.href;
		const browserInfo = getBrowserInfo();

		const params = new URLSearchParams({
			template: 'user-report.yml',
			labels: 'user-report',
			'page-url': pageUrl,
			'browser-info': browserInfo,
		});

		const githubUrl = `https://github.com/melbourne-disc-golf/mdgc-website/issues/new?${params.toString()}`;

		// Open in new window
		window.open(githubUrl, '_blank', 'noopener,noreferrer');

		closeModal();
	}

	// Open modal with animation
	reportBtn?.addEventListener('click', () => {
		modal?.classList.remove('hidden');
		// Trigger animation after render
		requestAnimationFrame(() => {
			modalContent?.classList.remove('opacity-0', 'scale-95');
			modalContent?.classList.add('opacity-100', 'scale-100');
		});
	});

	// Close modal with animation
	const closeModal = () => {
		modalContent?.classList.remove('opacity-100', 'scale-100');
		modalContent?.classList.add('opacity-0', 'scale-95');
		// Wait for animation to complete
		setTimeout(() => {
			modal?.classList.add('hidden');
		}, 200);
	};

	closeBtn?.addEventListener('click', closeModal);
	cancelBtn?.addEventListener('click', closeModal);
	submitBtn?.addEventListener('click', openGitHubIssue);
	emailBtn?.addEventListener('click', () => {
		window.location.href = 'mailto:webmaster@melbournediscgolf.com';
		closeModal();
	});

	// Close on backdrop click
	modal?.addEventListener('click', (e) => {
		if (e.target === modal) {
			closeModal();
		}
	});
</script>
